{"version":3,"file":"ListView.js","sources":["../../src/components/DataView/ListView.js"],"sourcesContent":["import React, { useCallback, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from 'react-spring'\nimport { GU, springs, textStyle } from '../../style'\nimport { useTheme } from '../../theme'\nimport Checkbox from '../Input/Checkbox'\nimport { ToggleButton } from './ToggleButton'\nimport { OpenedSurfaceBorder } from './OpenedSurfaceBorder'\n\nfunction ListView({\n  allSelected,\n  entries,\n  fields,\n  hasAnyExpansion,\n  onSelect,\n  onSelectAll,\n  renderSelectionCount,\n  selectable,\n  rowHeight,\n}) {\n  const theme = useTheme()\n\n  const [opened, setOpened] = useState(-1)\n\n  const toggleEntry = useCallback(index => {\n    setOpened(opened => (opened === index ? -1 : index))\n  }, [])\n\n  const sideSpace = selectable || hasAnyExpansion\n\n  return (\n    <React.Fragment>\n      {entries.map((entry, index) => {\n        const hasExpansion = entry.expansion.content.length > 0\n        return (\n          <div\n            key={index}\n            css={`\n              position: relative;\n              padding: 0;\n              padding-right: ${3 * GU}px;\n              padding-left: ${(sideSpace ? 6.5 : 3) * GU}px;\n              border-bottom: ${Number(index !== entries.length - 1)}px solid\n                ${theme.border};\n              transition: background 150ms ease-in-out;\n              background: ${entry.selected ? theme.surfaceSelected : 'none'};\n            `}\n          >\n            <OpenedSurfaceBorder opened={entry.index === opened} />\n            {sideSpace && (\n              <div\n                css={`\n                  position: absolute;\n                  top: ${1.5 * GU}px;\n                  left: 0;\n                  display: flex;\n                  justify-content: center;\n                  width: ${6.5 * GU}px;\n                `}\n              >\n                {selectable && (\n                  <Select\n                    index={entry.index}\n                    selected={entry.selected}\n                    onSelect={onSelect}\n                  />\n                )}\n                {!selectable && hasExpansion && (\n                  <ToggleButton\n                    opened={entry.index === opened}\n                    onClick={() => toggleEntry(entry.index)}\n                  />\n                )}\n              </div>\n            )}\n            {entry.actions && (\n              <div\n                css={`\n                  position: absolute;\n                  top: ${2 * GU}px;\n                  right: ${3 * GU}px;\n                `}\n              >\n                {entry.actions}\n              </div>\n            )}\n            <div>\n              {entry.entryNodes\n                .map((content, index) => [\n                  // field content\n                  content,\n                  // field label\n                  fields[index].label,\n                  // priority number\n                  (fields[index].priority && fields[index].priority) || 0,\n                ])\n                // sort by priority\n                .sort((a, b) => b[2] - a[2])\n                .map(([content, label], index, entryNodes) => (\n                  <div\n                    key={index}\n                    css={`\n                      display: flex;\n                      flex-direction: column;\n                      padding-bottom: ${index === entryNodes.length - 1\n                        ? 2 * GU\n                        : 0}px;\n                    `}\n                  >\n                    <div\n                      css={`\n                        display: flex;\n                        align-items: center;\n                        margin: ${2 * GU}px 0 ${1 * GU}px;\n                        color: ${theme.surfaceContentSecondary};\n                        ${textStyle('label2')};\n                      `}\n                    >\n                      {label}\n                    </div>\n\n                    <div>{content}</div>\n                  </div>\n                ))}\n            </div>\n            {hasExpansion && (\n              <EntryExpansion\n                expansion={entry.expansion}\n                opened={opened === entry.index}\n                rowHeight={rowHeight}\n              />\n            )}\n          </div>\n        )\n      })}\n    </React.Fragment>\n  )\n}\n\nListView.propTypes = {\n  allSelected: PropTypes.oneOf([-1, 0, 1]).isRequired,\n  entries: PropTypes.array.isRequired,\n  fields: PropTypes.array.isRequired,\n  hasAnyExpansion: PropTypes.bool.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onSelectAll: PropTypes.func.isRequired,\n  renderSelectionCount: PropTypes.func.isRequired,\n  rowHeight: PropTypes.number.isRequired,\n  selectable: PropTypes.bool.isRequired,\n}\n\n// Disable prop types check for internal components\n/* eslint-disable react/prop-types */\n\nfunction EntryExpansion({ expansion, opened, rowHeight }) {\n  const theme = useTheme()\n\n  // Handles the height of the expansion in free layout mode\n  const [freeLayoutContentHeight, setFreeLayoutContentHeight] = useState(0)\n\n  const handleFreeLayoutContentRef = useCallback(element => {\n    if (element) {\n      setFreeLayoutContentHeight(element.getBoundingClientRect().height)\n    }\n  }, [])\n\n  const height = expansion.freeLayout\n    ? freeLayoutContentHeight\n    : rowHeight * expansion.content.length\n\n  return (\n    <Transition\n      native\n      items={opened}\n      from={{ height: 0 }}\n      enter={{ height }}\n      update={{ height }}\n      leave={{ height: 0 }}\n      config={{ ...springs.smooth, precision: 0.1 }}\n    >\n      {show =>\n        show &&\n        (({ height }) => (\n          <animated.div\n            css={`\n              overflow: hidden;\n              background: ${theme.surfaceUnder};\n              margin-left: ${-6.5 * GU}px;\n              margin-right: ${-3 * GU}px;\n              padding-left: ${6.5 * GU}px;\n              box-shadow: inset 0 6px 4px -4px rgba(0, 0, 0, 0.16);\n            `}\n            style={{\n              height: height.interpolate(v => `${v}px`),\n            }}\n          >\n            {expansion.content.map((child, i) => (\n              <div\n                key={i}\n                ref={expansion.freeLayout ? handleFreeLayoutContentRef : null}\n                css={`\n                  display: flex;\n                  align-items: center;\n                  height: ${expansion.freeLayout ? 'auto' : `${rowHeight}px`};\n                  padding-right: ${3 * GU}px;\n                `}\n              >\n                {child}\n              </div>\n            ))}\n          </animated.div>\n        ))\n      }\n    </Transition>\n  )\n}\n\nfunction Select({ index, selected, onSelect }) {\n  const change = useCallback(\n    check => {\n      onSelect(index, check)\n    },\n    [index, onSelect]\n  )\n\n  return <Checkbox onChange={change} checked={selected} />\n}\n\n/* eslint-enable react/prop-types */\n\nexport { ListView }\n"],"names":["ListView","allSelected","entries","fields","hasAnyExpansion","onSelect","onSelectAll","renderSelectionCount","selectable","rowHeight","theme","useTheme","useState","opened","setOpened","toggleEntry","useCallback","index","sideSpace","map","entry","hasExpansion","expansion","content","length","GU","Number","border","selected","surfaceSelected","actions","entryNodes","label","priority","sort","a","b","surfaceContentSecondary","textStyle","propTypes","PropTypes","oneOf","isRequired","array","bool","func","number","EntryExpansion","freeLayoutContentHeight","setFreeLayoutContentHeight","handleFreeLayoutContentRef","element","getBoundingClientRect","height","freeLayout","springs","smooth","precision","show","interpolate","v","surfaceUnder","child","i","Select","change","check"],"mappings":"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"}