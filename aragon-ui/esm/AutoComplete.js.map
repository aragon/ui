{"version":3,"file":"AutoComplete.js","sources":["../../src/components/AutoComplete/AutoComplete.js"],"sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from 'react-spring'\nimport {\n  useArrowKeysFocus,\n  useClickOutside,\n  useKeyDown,\n  useFocusLeave,\n} from '../../hooks'\nimport { springs } from '../../style'\nimport { useTheme } from '../../theme'\nimport { unselectable, noop, identity, KEY_ESC } from '../../utils'\nimport ButtonBase from '../ButtonBase/ButtonBase'\nimport SearchInput from '../Input/SearchInput'\n\nfunction AutoComplete({\n  forwardedRef,\n  itemButtonStyles = '',\n  items = [],\n  onSelect = noop,\n  onChange = noop,\n  placeholder,\n  renderItem = identity,\n  required,\n  value,\n  wide,\n}) {\n  const ref = forwardedRef\n  const uniqueItems = new Set(items)\n  const [opened, setOpened] = useState(true)\n  const wrapRef = useRef()\n  const refs = useRef([])\n\n  const handleClose = useCallback(() => setOpened(false), [])\n  const handleFocus = useCallback(() => setOpened(true), [])\n\n  const handleSelect = useCallback(\n    item => {\n      onSelect(item)\n      setOpened(false)\n    },\n    [onSelect]\n  )\n\n  const handleInputChange = useCallback(\n    (...params) => {\n      setOpened(true)\n      onChange(...params)\n    },\n    [onChange]\n  )\n\n  const { handleFocusLeave } = useFocusLeave(handleClose, wrapRef)\n  const { highlightedIndex, setHighlightedIndex } = useArrowKeysFocus(refs)\n\n  useClickOutside(handleClose, wrapRef)\n  useKeyDown(KEY_ESC, handleClose)\n\n  useEffect(() => {\n    setHighlightedIndex(-1)\n  }, [opened, items, value, setHighlightedIndex])\n\n  return (\n    <div css=\"position: relative\" ref={wrapRef} onBlur={handleFocusLeave}>\n      <SearchInput\n        ref={ref}\n        wide={wide}\n        placeholder={placeholder}\n        required={required}\n        onChange={handleInputChange}\n        onFocus={handleFocus}\n        value={value}\n      />\n      <Transition\n        config={springs.swift}\n        items={opened && items.length > 0}\n        from={{ scale: 0.98, opacity: 0 }}\n        enter={{ scale: 1, opacity: 1 }}\n        leave={{ scale: 1, opacity: 0 }}\n        native\n      >\n        {show =>\n          show &&\n          /* eslint-disable react/prop-types */\n          (({ scale, opacity }) => (\n            <Items\n              style={{\n                opacity,\n                transform: scale.interpolate(t => `scale3d(${t},${t},1)`),\n              }}\n            >\n              {Array.from(uniqueItems).map((item, index) => (\n                <Item\n                  key={item.key || item}\n                  ref={node => (refs.current[index] = node)}\n                  index={index}\n                  item={item}\n                  itemButtonStyles={itemButtonStyles}\n                  onHighlight={setHighlightedIndex}\n                  onSelect={handleSelect}\n                  selected={index === highlightedIndex}\n                >\n                  {renderItem(item, value)}\n                </Item>\n              ))}\n            </Items>\n          ))\n        /* eslint-enable react/prop-types */\n        }\n      </Transition>\n    </div>\n  )\n}\n\nAutoComplete.propTypes = {\n  forwardedRef: PropTypes.object,\n  itemButtonStyles: PropTypes.string,\n  items: PropTypes.array.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  placeholder: PropTypes.string,\n  renderItem: PropTypes.func,\n  required: PropTypes.bool,\n  value: PropTypes.string,\n  wide: PropTypes.bool,\n}\n\n/* eslint-disable react/prop-types */\nconst Item = React.forwardRef(function Item(\n  { children, index, item, itemButtonStyles, onHighlight, onSelect, selected },\n  ref\n) {\n  const theme = useTheme()\n\n  const handleClick = useCallback(\n    event => {\n      event.preventDefault()\n      onSelect(item)\n    },\n    [item, onSelect]\n  )\n\n  const handleFocusOrMouseOver = useCallback(() => {\n    onHighlight(index)\n  }, [index, onHighlight])\n\n  return (\n    <li\n      role=\"option\"\n      css={`\n        overflow: hidden;\n        cursor: pointer;\n        ${unselectable()};\n      `}\n    >\n      <ButtonBase\n        ref={ref}\n        onClick={handleClick}\n        onFocus={handleFocusOrMouseOver}\n        onMouseOver={handleFocusOrMouseOver}\n        css={`\n          text-align: left;\n          padding: 4px 8px;\n          width: 100%;\n          border-radius: 0;\n          border-left: 3px solid transparent;\n          cursor: pointer;\n\n          ${selected\n            ? `\n                outline: 2px solid ${theme.accent};\n                background: ${theme.surfaceHighlight};\n                border-left: 3px solid ${theme.accent};\n              `\n            : ''};\n          ${itemButtonStyles};\n        `}\n      >\n        {children}\n      </ButtonBase>\n    </li>\n  )\n})\n/* eslint-enable react/prop-types */\n\n/* eslint-disable react/prop-types */\nconst Items = function Items(props) {\n  const theme = useTheme()\n  return (\n    <animated.ul\n      role=\"listbox\"\n      css={`\n        position: absolute;\n        z-index: 2;\n        top: 100%;\n        width: 100%;\n        padding: 8px 0;\n        color: ${theme.surfaceContent};\n        background: ${theme.surface};\n        border: 1px solid ${theme.border};\n        box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.06);\n        border-radius: 3px;\n        padding: 0;\n        margin: 0;\n        list-style: none;\n\n        & > li:first-child {\n          border-top-left-radius: 3px;\n          border-top-right-radius: 3px;\n        }\n        & > li:last-child {\n          border-bottom-left-radius: 3px;\n          border-bottom-right-radius: 3px;\n        }\n      `}\n      {...props}\n    />\n  )\n}\n/* eslint-enable react/prop-types */\n\nconst AutoCompleteMemo = React.memo(AutoComplete)\n\nexport default React.forwardRef((props, ref) => (\n  <AutoCompleteMemo {...props} forwardedRef={ref} />\n))\n"],"names":["AutoComplete","forwardedRef","itemButtonStyles","items","onSelect","noop","onChange","placeholder","renderItem","identity","required","value","wide","ref","uniqueItems","Set","useState","opened","setOpened","wrapRef","useRef","refs","handleClose","useCallback","handleFocus","handleSelect","item","handleInputChange","useFocusLeave","handleFocusLeave","useArrowKeysFocus","highlightedIndex","setHighlightedIndex","useClickOutside","useKeyDown","KEY_ESC","useEffect","springs","swift","length","scale","opacity","show","transform","interpolate","t","Array","from","map","index","key","node","current","propTypes","PropTypes","object","string","array","isRequired","func","bool","Item","React","forwardRef","children","onHighlight","selected","theme","useTheme","handleClick","event","preventDefault","handleFocusOrMouseOver","unselectable","accent","surfaceHighlight","Items","props","surfaceContent","surface","border","AutoCompleteMemo","memo"],"mappings":"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"}