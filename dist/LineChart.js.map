{"version":3,"file":"LineChart.js","sources":["../src/components/LineChart/LineChart.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport { Spring } from 'react-spring'\nimport PropTypes from '../../proptypes'\nimport { springs } from '../../style'\nimport { unselectable } from '../../utils'\n\nconst LABELS_HEIGHT = 30\nconst WIDTH_DEFAULT = 300\n\nfunction useMeasuredWidth() {\n  const ref = useRef()\n  const [measuredWidth, setMeasuredWidth] = useState(WIDTH_DEFAULT)\n\n  const onResize = useCallback(() => {\n    if (ref.current) {\n      setMeasuredWidth(ref.current.clientWidth)\n    }\n  }, [])\n\n  const onRef = useCallback(\n    element => {\n      ref.current = element\n      onResize()\n    },\n    [onResize]\n  )\n\n  useEffect(() => {\n    window.addEventListener('resize', onResize)\n    return () => window.removeEventListener('resize', onResize)\n  }, [onResize])\n\n  return [measuredWidth, onRef]\n}\n\nfunction LineChart({\n  animDelay,\n  borderColor,\n  color,\n  dotRadius,\n  height,\n  label,\n  labelColor,\n  lines: linesProps,\n  reset,\n  springConfig,\n  total,\n  width: widthProps,\n  ...props\n}) {\n  const [width, onSvgRef] = useMeasuredWidth()\n\n  const lines = useMemo(() => {\n    return linesProps.map(lineOrValues =>\n      Array.isArray(lineOrValues) ? { values: lineOrValues } : lineOrValues\n    )\n  }, [linesProps])\n\n  // the count of provided values\n  const valuesCount = useMemo(() => {\n    // All the values have the same length, so we can use the first one.\n    return lines[0] ? lines[0].values.length : 0\n  }, [lines])\n\n  // the total amount of values\n  const totalCount = useMemo(() => {\n    // If no total is provided, the total is the number of provided values.\n    return total > 0 && total > valuesCount ? total : valuesCount\n  }, [valuesCount, total])\n\n  const getX = useCallback(\n    index => {\n      return (width / Math.max(1, totalCount - 1)) * index\n    },\n    [width, totalCount]\n  )\n\n  const getY = useCallback(\n    (percentage, progress, height) => {\n      const padding = dotRadius + 2\n      return height - padding - (height - padding * 2) * percentage * progress\n    },\n    [dotRadius]\n  )\n\n  const getLabelPosition = useCallback((index, length) => {\n    if (index === 0) return 'start'\n    if (index === length - 1) return 'end'\n    return 'middle'\n  }, [])\n\n  const labels =\n    label && totalCount > 0 ? [...Array(totalCount).keys()].map(label) : null\n\n  const chartHeight = height - (labels ? LABELS_HEIGHT : 0)\n\n  const rectangle = (\n    <rect\n      width={width}\n      height={chartHeight}\n      rx=\"3\"\n      ry=\"3\"\n      fill=\"#ffffff\"\n      strokeWidth=\"1\"\n      stroke={borderColor}\n    />\n  )\n\n  return (\n    <Spring\n      from={{ progress: 0 }}\n      to={{ progress: 1 }}\n      config={springConfig}\n      delay={animDelay}\n      reset={reset}\n    >\n      {({ progress }) => (\n        <svg\n          ref={onSvgRef}\n          viewBox={`0 0 ${width} ${height}`}\n          width={widthProps || 'auto'}\n          height=\"auto\"\n          css=\"display: block\"\n          {...props}\n        >\n          <mask id=\"chart-mask\">{rectangle}</mask>\n          {rectangle}\n\n          <g mask=\"url(#chart-mask)\">\n            {totalCount > 0 && (\n              <path\n                d={`\n                  ${[...new Array(totalCount - 1)].reduce(\n                    (path, _, index) =>\n                      `${path} M ${getX(index)},${chartHeight} l 0,-8`,\n                    ''\n                  )}\n                `}\n                stroke={borderColor}\n                strokeWidth=\"1\"\n              />\n            )}\n            {lines.map((line, lineIndex) => (\n              <g key={`line-plot-${line.id || lineIndex}`}>\n                <path\n                  d={`\n                    M\n                    ${getX(0)},\n                    ${getY(line.values[0], progress, chartHeight)}\n\n                    ${line.values\n                      .slice(1)\n                      .map(\n                        (val, index) =>\n                          `L\n                           ${getX((index + 1) * progress)},\n                           ${getY(val, progress, chartHeight)}\n                          `\n                      )\n                      .join('')}\n                  `}\n                  fill=\"transparent\"\n                  stroke={line.color || color(lineIndex, { lines })}\n                  strokeWidth=\"2\"\n                />\n                {line.values.slice(1, -1).map((val, index) => (\n                  <circle\n                    key={index}\n                    cx={getX(index + 1) * progress}\n                    cy={getY(val, progress, chartHeight)}\n                    r={dotRadius}\n                    fill=\"white\"\n                    stroke={line.color || color(lineIndex, { lines })}\n                    strokeWidth=\"1\"\n                  />\n                ))}\n              </g>\n            ))}\n            <line\n              x1={getX(valuesCount - 1) * progress}\n              y1=\"0\"\n              x2={getX(valuesCount - 1) * progress}\n              y2={chartHeight}\n              stroke=\"#DAEAEF\"\n              strokeWidth=\"3\"\n            />\n          </g>\n          {labels && (\n            <g transform={`translate(0,${chartHeight})`}>\n              {labels.map((label, index) => (\n                <text\n                  key={index}\n                  x={getX(index)}\n                  y={LABELS_HEIGHT / 2}\n                  textAnchor={getLabelPosition(index, labels.length)}\n                  fill={labelColor}\n                  css={`\n                    alignment-baseline: middle;\n                    font-size: 12px;\n                    font-weight: 300;\n                    ${unselectable};\n                  `}\n                >\n                  {label}\n                </text>\n              ))}\n            </g>\n          )}\n        </svg>\n      )}\n    </Spring>\n  )\n}\n\nLineChart.propTypes = {\n  springConfig: PropTypes._spring,\n  total: PropTypes.number,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  dotRadius: PropTypes.number,\n  animDelay: PropTypes.number,\n  borderColor: PropTypes.string,\n  labelColor: PropTypes.string,\n  reset: PropTypes.bool,\n  lines: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      PropTypes.shape({\n        id: PropTypes.number,\n        values: PropTypes.arrayOf(PropTypes.number).isRequired, // numbers between 0 and 1\n        color: PropTypes.string, // overrides the color() prop if set\n      }),\n      // values can also be passed directly\n      PropTypes.arrayOf(PropTypes.number),\n    ])\n  ),\n  label: PropTypes.oneOfType([PropTypes.func, PropTypes._null]),\n  color: PropTypes.func,\n}\n\nLineChart.defaultProps = {\n  springConfig: springs.lazy,\n  total: -1,\n  height: 200,\n  dotRadius: 7 / 2,\n  animDelay: 500,\n  reset: false,\n  borderColor: 'rgba(209, 209, 209, 0.5)',\n  labelColor: '#6d777b',\n  lines: [],\n  label: index => index + 1,\n  color: (index, { lines }) =>\n    `hsl(${(index * (360 / lines.length) + 40) % 360}, 60%, 70%)`,\n}\n\nexport default LineChart\n"],"names":["LABELS_HEIGHT","WIDTH_DEFAULT","useMeasuredWidth","ref","useRef","measuredWidth","setMeasuredWidth","useState","onResize","useCallback","current","clientWidth","onRef","element","useEffect","window","addEventListener","removeEventListener","LineChart","animDelay","borderColor","color","dotRadius","height","label","labelColor","lines","linesProps","reset","springConfig","total","width","widthProps","props","onSvgRef","useMemo","map","lineOrValues","Array","isArray","values","valuesCount","length","totalCount","getX","index","Math","max","getY","percentage","progress","padding","getLabelPosition","labels","keys","chartHeight","rectangle","React","Spring","reduce","path","_","line","lineIndex","id","slice","val","join","propTypes","PropTypes","_spring","number","string","bool","arrayOf","oneOfType","shape","isRequired","func","_null","defaultProps","springs","lazy","unselectable"],"mappings":"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"}