{"version":3,"file":"DateRangePicker.js","sources":["../../../../../src/components/DateRangePicker/DateRangePicker.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport dayjs from 'dayjs'\nimport Button from '../Button/Button'\nimport { useViewport } from '../../providers/Viewport/Viewport'\nimport { GU, RADIUS } from '../../style'\nimport { useTheme } from '../../theme'\nimport DatePicker from './DatePicker'\nimport Labels from './Labels'\nimport { START_DATE, END_DATE } from './consts'\nimport { handleDateSelect } from './utils'\nimport Popover from '../Popover/Popover'\n\nfunction DateRangePicker({\n  format,\n  endDate: endDateProp,\n  onChange,\n  startDate: startDateProp,\n}) {\n  const theme = useTheme()\n  const labelsRef = useRef()\n  const [showPicker, setShowPicker] = useState(false)\n  const [startDate, setStartDate] = useState(startDateProp)\n  const [endDate, setEndDate] = useState(endDateProp)\n\n  // on closing the picked, reset state\n  useEffect(() => {\n    if (!showPicker) {\n      setStartDate(startDateProp)\n      setEndDate(endDateProp)\n    }\n  }, [endDateProp, startDateProp, showPicker])\n\n  const handlePopoverClose = useCallback(() => setShowPicker(false), [])\n\n  const handleLabelsClick = useCallback(() => {\n    setShowPicker(show => !show)\n  }, [])\n\n  const handleDateClick = useCallback(\n    date => {\n      const result = handleDateSelect({ date, startDate, endDate })\n      result.startDate !== undefined && setStartDate(result.startDate)\n      result.endDate !== undefined && setEndDate(result.endDate)\n    },\n    [startDate, endDate]\n  )\n\n  const handleApply = useCallback(() => {\n    setShowPicker(false)\n\n    if (startDate && endDate) {\n      onChange({\n        start: dayjs(startDate)\n          .startOf('day')\n          .toDate(),\n        end: dayjs(endDate)\n          .endOf('day')\n          .toDate(),\n      })\n    }\n  }, [endDate, onChange, startDate])\n\n  const handleClear = useCallback(() => {\n    setStartDate(null)\n    setEndDate(null)\n    setShowPicker(false)\n    onChange({ start: null, end: null })\n  }, [onChange])\n\n  const labelProps = useMemo(() => {\n    const _startDate = showPicker ? startDate : startDateProp\n    const _endDate = showPicker ? endDate : endDateProp\n    return {\n      startText: _startDate ? dayjs(_startDate).format(format) : START_DATE,\n      endText: _endDate ? dayjs(_endDate).format(format) : END_DATE,\n    }\n  }, [endDate, endDateProp, format, showPicker, startDate, startDateProp])\n\n  const compactMode = useViewport().below('medium')\n\n  const displayMonthBeforeOnLeft = useMemo(() => {\n    // If both dates are in the same month, use the right calendar\n    // for it, and display month before on the left calendar.\n    const propsDatesInSameMonth =\n      startDateProp &&\n      endDateProp &&\n      dayjs(startDateProp).isSame(dayjs(endDateProp), 'month')\n\n    return !compactMode && (propsDatesInSameMonth || !startDateProp)\n  }, [compactMode, endDateProp, startDateProp])\n\n  return (\n    <div>\n      <Labels\n        ref={labelsRef}\n        enabled={showPicker}\n        hasSetDates={Boolean(startDateProp && endDateProp)}\n        onClick={handleLabelsClick}\n        {...labelProps}\n      />\n      <Popover\n        closeOnOpenerFocus\n        onClose={handlePopoverClose}\n        opener={labelsRef.current}\n        placement=\"bottom-start\"\n        visible={showPicker}\n        css={`\n          min-width: ${37.5 * GU + 2}px;\n          border: 0;\n          filter: none;\n          background: none;\n          margin: 2px 0 0 0;\n        `}\n      >\n        <div\n          css={`\n            padding: ${2.5 * GU}px ${3 * GU}px ${3 * GU}px;\n            border: 1px solid ${theme.border};\n            border-radius: ${RADIUS}px;\n            background: ${theme.surface};\n          `}\n        >\n          <div\n            css={`\n              display: flex;\n              flex-direction: row;\n              align-items: baseline;\n            `}\n          >\n            <DatePicker\n              datesRangeEnd={endDate}\n              datesRangeStart={startDate}\n              initialDate={dayjs(startDateProp || undefined)\n                .subtract(displayMonthBeforeOnLeft ? 1 : 0, 'month')\n                .toDate()}\n              onSelect={handleDateClick}\n            />\n            {!compactMode && (\n              <DatePicker\n                datesRangeEnd={endDate}\n                datesRangeStart={startDate}\n                initialDate={dayjs(endDateProp || undefined).toDate()}\n                onSelect={handleDateClick}\n                css={`\n                  margin-left: ${1 * GU}px;\n                `}\n              />\n            )}\n          </div>\n\n          <div\n            css={`\n              display: flex;\n              align-items: center;\n              justify-content: space-between;\n              margin-top: ${GU * 2.25}px;\n\n              ${compactMode\n                ? ''\n                : `\n                    max-width: 247px;\n                    margin-left: auto;\n                  `};\n            `}\n          >\n            <Button onClick={handleClear} size=\"small\" wide>\n              Reset\n            </Button>\n            <Button\n              disabled={!startDate || !endDate}\n              mode=\"strong\"\n              onClick={handleApply}\n              size=\"small\"\n              wide\n              css={`\n                margin-left: ${1.5 * GU}px;\n              `}\n            >\n              Apply\n            </Button>\n          </div>\n        </div>\n      </Popover>\n    </div>\n  )\n}\n\nDateRangePicker.propTypes = {\n  endDate: PropTypes.instanceOf(Date),\n  format: PropTypes.string,\n  onChange: PropTypes.func,\n  startDate: PropTypes.instanceOf(Date),\n}\n\nDateRangePicker.defaultProps = {\n  format: 'MM/DD/YYYY',\n  onChange: () => {},\n}\n\nexport default DateRangePicker\n"],"names":["DateRangePicker","format","endDate","endDateProp","onChange","startDate","startDateProp","theme","useTheme","labelsRef","useRef","showPicker","setShowPicker","useState","setStartDate","setEndDate","useEffect","handlePopoverClose","useCallback","handleLabelsClick","show","handleDateClick","date","result","handleDateSelect","undefined","handleApply","start","dayjs","startOf","toDate","end","endOf","handleClear","labelProps","useMemo","_startDate","_endDate","startText","START_DATE","endText","END_DATE","compactMode","useViewport","below","displayMonthBeforeOnLeft","propsDatesInSameMonth","isSame","Boolean","current","GU","border","surface","subtract","Button","propTypes","PropTypes","instanceOf","Date","string","func","defaultProps","RADIUS"],"mappings":"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"}