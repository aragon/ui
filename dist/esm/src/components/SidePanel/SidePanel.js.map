{"version":3,"file":"SidePanel.js","sources":["../../../../../src/components/SidePanel/SidePanel.js"],"sourcesContent":["import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from 'react-spring'\nimport { Inside } from 'use-inside'\nimport ButtonIcon from '../Button/ButtonIcon'\nimport { IconClose } from '../../icons'\nimport { useViewport } from '../../providers/Viewport/Viewport'\nimport { GU, springs, textStyle } from '../../style'\nimport { useTheme } from '../../theme'\nimport { unselectable, KEY_ESC, warn } from '../../utils'\nimport RootPortal from '../RootPortal/RootPortal'\n\nconst CONTENT_PADDING = 3 * GU\n\n// The closing position of the panel, on the right side of the viewport.\n// It takes into consideration the shadow of the panel.\nconst CLOSING_POSITION = 5 * GU\n\nconst SidePanelContext = React.createContext(null)\n\nfunction SidePanel({\n  blocking,\n  children,\n  opened,\n  onClose,\n  onTransitionEnd,\n  title,\n}) {\n  const theme = useTheme()\n  const { below } = useViewport()\n  const compact = below('medium')\n\n  const close = useCallback(() => {\n    if (!blocking) {\n      onClose()\n    }\n  }, [blocking, onClose])\n\n  const handleEscape = useCallback(\n    event => {\n      if (event.keyCode === KEY_ESC && opened) {\n        close()\n      }\n    },\n    [opened, close]\n  )\n\n  const [status, setStatus] = useState(opened ? 'opened' : 'closed')\n  const [readyToFocus, setReadyToFocus] = useState(false)\n\n  const handleTransitionRest = useCallback(() => {\n    onTransitionEnd(opened)\n    setStatus(opened ? 'opened' : 'closed')\n  }, [opened, onTransitionEnd])\n\n  const handleTransitionStart = useCallback(() => {\n    setStatus(opened ? 'opening' : 'closing')\n  }, [opened])\n\n  const handleTransitionFrame = useCallback(\n    (item, _, { progress }) => {\n      if (progress > 0.5 && !readyToFocus) {\n        setReadyToFocus(true)\n      } else if (progress < 0.5 && readyToFocus) {\n        setReadyToFocus(false)\n      }\n    },\n    [readyToFocus]\n  )\n\n  const handleTransitionDestroyed = useCallback(() => {\n    setReadyToFocus(false)\n  }, [])\n\n  useEffect(() => {\n    document.addEventListener('keydown', handleEscape)\n    return () => {\n      document.removeEventListener('keydown', handleEscape)\n    }\n  }, [handleEscape])\n\n  return (\n    <RootPortal>\n      <Inside name=\"SidePanel\">\n        <Transition\n          items={opened}\n          config={{ ...springs.lazy, precision: 0.001 }}\n          from={{ progress: 0 }}\n          enter={{ progress: Number(opened) }}\n          leave={{ progress: 0 }}\n          onRest={handleTransitionRest}\n          onStart={handleTransitionStart}\n          onFrame={handleTransitionFrame}\n          onDestroyed={handleTransitionDestroyed}\n          unique\n          native\n        >\n          {opened =>\n            opened &&\n            (({ progress }) => (\n              <div\n                css={`\n                  position: absolute;\n                  z-index: 1;\n                  top: 0;\n                  left: 0;\n                  right: 0;\n                  bottom: 0;\n                  pointer-events: ${status !== 'closing' ? 'auto' : 'none'};\n                  overflow: hidden;\n                `}\n              >\n                <animated.div\n                  onClick={close}\n                  style={{\n                    opacity: progress,\n                    pointerEvents: status !== 'closing' ? 'auto' : 'none',\n                  }}\n                  css={`\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: ${theme.overlay.alpha(0.9)};\n                  `}\n                />\n                <Panel\n                  compact={compact}\n                  style={{\n                    transform: progress.interpolate(\n                      v =>\n                        `\n                          translate3d(\n                            calc(\n                              ${100 * (1 - v)}% +\n                              ${CLOSING_POSITION * (1 - v)}px\n                            ), 0, 0\n                          )\n                        `\n                    ),\n                  }}\n                >\n                  <header\n                    css={`\n                      display: flex;\n                      flex-direction: column;\n                      justify-content: center;\n                      flex-shrink: 0;\n                      position: relative;\n                      height: ${8 * GU}px;\n                      padding-left: ${CONTENT_PADDING}px;\n                      border-bottom: 1px solid ${theme.border};\n                      ${unselectable()};\n                    `}\n                  >\n                    <h1\n                      css={`\n                        color: ${theme.surfaceContent};\n                        ${textStyle('body1')};\n                      `}\n                    >\n                      {title}\n                    </h1>\n                    {!blocking && (\n                      <ButtonIcon\n                        label=\"Close\"\n                        onClick={close}\n                        css={`\n                          position: absolute;\n                          ${!compact\n                            ? `\n                              top: ${2 * GU}px;\n                              right: ${2 * GU}px;\n                            `\n                            : `\n                              top: 0;\n                              right: 0;\n                              height: ${8 * GU}px;\n                              width: ${8 * GU}px;\n                            `}\n                        `}\n                      >\n                        <IconClose color={theme.surfaceIcon} />\n                      </ButtonIcon>\n                    )}\n                  </header>\n                  <div\n                    css={`\n                      overflow-y: auto;\n                      height: 100%;\n                      display: flex;\n                      flex-direction: column;\n                    `}\n                  >\n                    <div\n                      css={`\n                        min-height: 0;\n                        flex-grow: 1;\n                        flex-shrink: 0;\n                        display: flex;\n                        flex-direction: column;\n                        width: 100%;\n                        padding-right: ${CONTENT_PADDING}px;\n                        padding-left: ${CONTENT_PADDING}px;\n                        padding-bottom: ${CONTENT_PADDING}px;\n                      `}\n                    >\n                      <SidePanelContext.Provider\n                        value={{ status, readyToFocus }}\n                      >\n                        {children}\n                      </SidePanelContext.Provider>\n                    </div>\n                  </div>\n                </Panel>\n              </div>\n            ))\n          }\n        </Transition>\n      </Inside>\n    </RootPortal>\n  )\n}\n\nSidePanel.propTypes = {\n  blocking: PropTypes.bool,\n  children: PropTypes.node.isRequired,\n  opened: PropTypes.bool,\n  onClose: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n  title: PropTypes.node.isRequired,\n}\n\nSidePanel.defaultProps = {\n  opened: true,\n  blocking: false,\n  onClose: () => {},\n  onTransitionEnd: () => {},\n}\n\nconst Panel = React.memo(function Panel({ compact, ...props }) {\n  const theme = useTheme()\n  return (\n    <animated.aside\n      css={`\n        position: absolute;\n        top: 0;\n        right: 0;\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        height: 100%;\n        background: ${theme.surface};\n        box-shadow: -2px 0px 4px rgba(0, 0, 0, 0.1);\n        ${!compact ? 'max-width: 450px;' : ''}\n      `}\n      {...props}\n    />\n  )\n})\n\nPanel.propTypes = {\n  compact: PropTypes.bool,\n}\n\nfunction useSidePanel() {\n  const value = useContext(SidePanelContext)\n  if (value === null) {\n    throw new Error(\n      'useSidePanel() was used outside of the SidePanel render tree, ' +\n        'which has to be declared at an upper level!'\n    )\n  }\n  return value\n}\n\nfunction useSidePanelFocusOnReady(ref) {\n  const { readyToFocus } = useSidePanel()\n  const fallbackRef = useRef()\n\n  const _ref = ref || fallbackRef\n\n  useEffect(() => {\n    if (readyToFocus && _ref.current) {\n      if (_ref.current.focus) {\n        _ref.current.focus()\n      } else {\n        warn(\n          'useSidePanelFocusOnReady(): the focus() method wasnâ€™t available on ' +\n            'the passed ref.'\n        )\n      }\n    }\n  }, [readyToFocus, _ref])\n\n  return _ref\n}\n\n// Used for spacing in SidePanelSplit and SidePanelSeparator\nSidePanel.HORIZONTAL_PADDING = CONTENT_PADDING\n\nexport { useSidePanel, useSidePanelFocusOnReady }\nexport default SidePanel\n"],"names":["CONTENT_PADDING","GU","CLOSING_POSITION","SidePanelContext","React","createContext","SidePanel","blocking","children","opened","onClose","onTransitionEnd","title","theme","useTheme","below","useViewport","compact","close","useCallback","handleEscape","event","keyCode","KEY_ESC","status","setStatus","useState","readyToFocus","setReadyToFocus","handleTransitionRest","handleTransitionStart","handleTransitionFrame","item","_","progress","handleTransitionDestroyed","useEffect","document","addEventListener","removeEventListener","Inside","springs","lazy","precision","Number","opacity","pointerEvents","overlay","alpha","transform","interpolate","v","border","unselectable","surfaceContent","textStyle","IconClose","surfaceIcon","propTypes","PropTypes","bool","node","isRequired","func","defaultProps","Panel","memo","props","surface","useSidePanel","value","useContext","Error","useSidePanelFocusOnReady","ref","fallbackRef","useRef","_ref","current","focus","warn","HORIZONTAL_PADDING"],"mappings":"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"}