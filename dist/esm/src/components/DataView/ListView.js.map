{"version":3,"file":"ListView.js","sources":["../../../../../src/components/DataView/ListView.js"],"sourcesContent":["import React, { useCallback, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from 'react-spring'\nimport { GU, springs, textStyle } from '../../style'\nimport { useTheme } from '../../theme'\nimport Checkbox from '../Input/Checkbox'\nimport { ToggleButton } from './ToggleButton'\nimport { OpenedSurfaceBorder } from './OpenedSurfaceBorder'\n\nfunction ListView({\n  allSelected,\n  entries,\n  fields,\n  hasAnyExpansion,\n  onSelect,\n  onSelectAll,\n  renderSelectionCount,\n  selectable,\n  rowHeight,\n}) {\n  const theme = useTheme()\n\n  const [opened, setOpened] = useState(-1)\n\n  const toggleEntry = useCallback(index => {\n    setOpened(opened => (opened === index ? -1 : index))\n  }, [])\n\n  const sideSpace = selectable || hasAnyExpansion\n\n  return (\n    <React.Fragment>\n      {entries.map((entry, index) => {\n        const hasExpansion = entry.expansion.content.length > 0\n        return (\n          <div\n            key={index}\n            css={`\n              position: relative;\n              padding: 0;\n              padding-right: ${3 * GU}px;\n              padding-left: ${(sideSpace ? 6.5 : 3) * GU}px;\n              border-bottom: ${Number(index !== entries.length - 1)}px solid\n                ${theme.border};\n              transition: background 150ms ease-in-out;\n              background: ${entry.selected ? theme.surfaceSelected : 'none'};\n            `}\n          >\n            <OpenedSurfaceBorder opened={entry.index === opened} />\n            {sideSpace && (\n              <div\n                css={`\n                  position: absolute;\n                  top: ${1.5 * GU}px;\n                  left: 0;\n                  display: flex;\n                  justify-content: center;\n                  width: ${6.5 * GU}px;\n                `}\n              >\n                {selectable && (\n                  <Select\n                    index={entry.index}\n                    selected={entry.selected}\n                    onSelect={onSelect}\n                  />\n                )}\n                {!selectable && hasExpansion && (\n                  <ToggleButton\n                    opened={entry.index === opened}\n                    onClick={() => toggleEntry(entry.index)}\n                  />\n                )}\n              </div>\n            )}\n            {entry.actions && (\n              <div\n                css={`\n                  position: absolute;\n                  top: ${2 * GU}px;\n                  right: ${3 * GU}px;\n                `}\n              >\n                {entry.actions}\n              </div>\n            )}\n            <div>\n              {entry.entryNodes\n                .map((content, index) => [\n                  // field content\n                  content,\n                  // field label\n                  fields[index].label,\n                  // priority number\n                  (fields[index].priority && fields[index].priority) || 0,\n                ])\n                // sort by priority\n                .sort((a, b) => b[2] - a[2])\n                .map(([content, label], index, entryNodes) => (\n                  <div\n                    key={index}\n                    css={`\n                      display: flex;\n                      flex-direction: column;\n                      padding-bottom: ${index === entryNodes.length - 1\n                        ? 2 * GU\n                        : 0}px;\n                    `}\n                  >\n                    <div\n                      css={`\n                        display: flex;\n                        align-items: center;\n                        margin: ${2 * GU}px 0 ${1 * GU}px;\n                        color: ${theme.surfaceContentSecondary};\n                        ${textStyle('label2')};\n                      `}\n                    >\n                      {label}\n                    </div>\n\n                    <div>{content}</div>\n                  </div>\n                ))}\n            </div>\n            {hasExpansion && (\n              <EntryExpansion\n                expansion={entry.expansion}\n                opened={opened === entry.index}\n                rowHeight={rowHeight}\n              />\n            )}\n          </div>\n        )\n      })}\n    </React.Fragment>\n  )\n}\n\nListView.propTypes = {\n  allSelected: PropTypes.oneOf([-1, 0, 1]).isRequired,\n  entries: PropTypes.array.isRequired,\n  fields: PropTypes.array.isRequired,\n  hasAnyExpansion: PropTypes.bool.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onSelectAll: PropTypes.func.isRequired,\n  renderSelectionCount: PropTypes.func.isRequired,\n  rowHeight: PropTypes.number.isRequired,\n  selectable: PropTypes.bool.isRequired,\n}\n\n// Disable prop types check for internal components\n/* eslint-disable react/prop-types */\n\nfunction EntryExpansion({ expansion, opened, rowHeight }) {\n  const theme = useTheme()\n\n  // Handles the height of the expansion in free layout mode\n  const [freeLayoutContentHeight, setFreeLayoutContentHeight] = useState(0)\n\n  const handleFreeLayoutContentRef = useCallback(element => {\n    if (element) {\n      setFreeLayoutContentHeight(element.getBoundingClientRect().height)\n    }\n  }, [])\n\n  const height = expansion.freeLayout\n    ? freeLayoutContentHeight\n    : rowHeight * expansion.content.length\n\n  return (\n    <Transition\n      native\n      items={opened}\n      from={{ height: 0 }}\n      enter={{ height }}\n      update={{ height }}\n      leave={{ height: 0 }}\n      config={{ ...springs.smooth, precision: 0.1 }}\n    >\n      {show =>\n        show &&\n        (({ height }) => (\n          <animated.div\n            css={`\n              overflow: hidden;\n              background: ${theme.surfaceUnder};\n              margin-left: ${-6.5 * GU}px;\n              margin-right: ${-3 * GU}px;\n              padding-left: ${6.5 * GU}px;\n              box-shadow: inset 0 6px 4px -4px rgba(0, 0, 0, 0.16);\n            `}\n            style={{\n              height: height.interpolate(v => `${v}px`),\n            }}\n          >\n            {expansion.content.map((child, i) => (\n              <div\n                key={i}\n                ref={expansion.freeLayout ? handleFreeLayoutContentRef : null}\n                css={`\n                  display: flex;\n                  align-items: center;\n                  height: ${expansion.freeLayout ? 'auto' : `${rowHeight}px`};\n                  padding-right: ${3 * GU}px;\n                `}\n              >\n                {child}\n              </div>\n            ))}\n          </animated.div>\n        ))\n      }\n    </Transition>\n  )\n}\n\nfunction Select({ index, selected, onSelect }) {\n  const change = useCallback(\n    check => {\n      onSelect(index, check)\n    },\n    [index, onSelect]\n  )\n\n  return <Checkbox onChange={change} checked={selected} />\n}\n\n/* eslint-enable react/prop-types */\n\nexport { ListView }\n"],"names":["ListView","allSelected","entries","fields","hasAnyExpansion","onSelect","onSelectAll","renderSelectionCount","selectable","rowHeight","theme","useTheme","opened","setOpened","useState","toggleEntry","useCallback","index","sideSpace","map","entry","hasExpansion","expansion","content","length","GU","Number","border","selected","surfaceSelected","actions","entryNodes","label","priority","sort","a","b","surfaceContentSecondary","textStyle","propTypes","PropTypes","oneOf","isRequired","array","bool","func","number","EntryExpansion","freeLayoutContentHeight","setFreeLayoutContentHeight","handleFreeLayoutContentRef","element","getBoundingClientRect","height","freeLayout","springs","smooth","precision","show","interpolate","v","surfaceUnder","child","i","Select","change","check","Checkbox"],"mappings":"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"}