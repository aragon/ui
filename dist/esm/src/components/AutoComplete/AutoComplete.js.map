{"version":3,"file":"AutoComplete.js","sources":["../../../../../src/components/AutoComplete/AutoComplete.js"],"sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from 'react-spring'\nimport {\n  useArrowKeysFocus,\n  useClickOutside,\n  useKeyDown,\n  useFocusLeave,\n} from '../../hooks'\nimport { springs } from '../../style'\nimport { useTheme } from '../../theme'\nimport { unselectable, noop, identity, KEY_ESC } from '../../utils'\nimport ButtonBase from '../ButtonBase/ButtonBase'\nimport SearchInput from '../Input/SearchInput'\n\nfunction AutoComplete({\n  forwardedRef,\n  itemButtonStyles = '',\n  items = [],\n  onSelect = noop,\n  onChange = noop,\n  placeholder,\n  renderItem = identity,\n  required,\n  value,\n  wide,\n}) {\n  const ref = forwardedRef\n  const uniqueItems = new Set(items)\n  const [opened, setOpened] = useState(true)\n  const wrapRef = useRef()\n  const refs = useRef([])\n\n  const handleClose = useCallback(() => setOpened(false), [])\n  const handleFocus = useCallback(() => setOpened(true), [])\n\n  const handleSelect = useCallback(\n    item => {\n      onSelect(item)\n      setOpened(false)\n    },\n    [onSelect]\n  )\n\n  const handleInputChange = useCallback(\n    (...params) => {\n      setOpened(true)\n      onChange(...params)\n    },\n    [onChange]\n  )\n\n  const { handleFocusLeave } = useFocusLeave(handleClose, wrapRef)\n  const { highlightedIndex, setHighlightedIndex } = useArrowKeysFocus(refs)\n\n  useClickOutside(handleClose, wrapRef)\n  useKeyDown(KEY_ESC, handleClose)\n\n  useEffect(() => {\n    setHighlightedIndex(-1)\n  }, [opened, items, value, setHighlightedIndex])\n\n  return (\n    <div css=\"position: relative\" ref={wrapRef} onBlur={handleFocusLeave}>\n      <SearchInput\n        ref={ref}\n        wide={wide}\n        placeholder={placeholder}\n        required={required}\n        onChange={handleInputChange}\n        onFocus={handleFocus}\n        value={value}\n      />\n      <Transition\n        config={springs.swift}\n        items={opened && items.length > 0}\n        from={{ scale: 0.98, opacity: 0 }}\n        enter={{ scale: 1, opacity: 1 }}\n        leave={{ scale: 1, opacity: 0 }}\n        native\n      >\n        {show =>\n          show &&\n          /* eslint-disable react/prop-types */\n          (({ scale, opacity }) => (\n            <Items\n              style={{\n                opacity,\n                transform: scale.interpolate(t => `scale3d(${t},${t},1)`),\n              }}\n            >\n              {Array.from(uniqueItems).map((item, index) => (\n                <Item\n                  key={item.key || item}\n                  ref={node => (refs.current[index] = node)}\n                  index={index}\n                  item={item}\n                  itemButtonStyles={itemButtonStyles}\n                  onHighlight={setHighlightedIndex}\n                  onSelect={handleSelect}\n                  selected={index === highlightedIndex}\n                >\n                  {renderItem(item, value)}\n                </Item>\n              ))}\n            </Items>\n          ))\n        /* eslint-enable react/prop-types */\n        }\n      </Transition>\n    </div>\n  )\n}\n\nAutoComplete.propTypes = {\n  forwardedRef: PropTypes.object,\n  itemButtonStyles: PropTypes.string,\n  items: PropTypes.array.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  placeholder: PropTypes.string,\n  renderItem: PropTypes.func,\n  required: PropTypes.bool,\n  value: PropTypes.string,\n  wide: PropTypes.bool,\n}\n\n/* eslint-disable react/prop-types */\nconst Item = React.forwardRef(function Item(\n  { children, index, item, itemButtonStyles, onHighlight, onSelect, selected },\n  ref\n) {\n  const theme = useTheme()\n\n  const handleClick = useCallback(\n    event => {\n      event.preventDefault()\n      onSelect(item)\n    },\n    [item, onSelect]\n  )\n\n  const handleFocusOrMouseOver = useCallback(() => {\n    onHighlight(index)\n  }, [index, onHighlight])\n\n  return (\n    <li\n      role=\"option\"\n      css={`\n        overflow: hidden;\n        cursor: pointer;\n        ${unselectable()};\n      `}\n    >\n      <ButtonBase\n        ref={ref}\n        onClick={handleClick}\n        onFocus={handleFocusOrMouseOver}\n        onMouseOver={handleFocusOrMouseOver}\n        css={`\n          text-align: left;\n          padding: 4px 8px;\n          width: 100%;\n          border-radius: 0;\n          border-left: 3px solid transparent;\n          cursor: pointer;\n\n          ${selected\n            ? `\n                outline: 2px solid ${theme.accent};\n                background: ${theme.surfaceHighlight};\n                border-left: 3px solid ${theme.accent};\n              `\n            : ''};\n          ${itemButtonStyles};\n        `}\n      >\n        {children}\n      </ButtonBase>\n    </li>\n  )\n})\n/* eslint-enable react/prop-types */\n\n/* eslint-disable react/prop-types */\nconst Items = function Items(props) {\n  const theme = useTheme()\n  return (\n    <animated.ul\n      role=\"listbox\"\n      css={`\n        position: absolute;\n        z-index: 2;\n        top: 100%;\n        width: 100%;\n        padding: 8px 0;\n        color: ${theme.surfaceContent};\n        background: ${theme.surface};\n        border: 1px solid ${theme.border};\n        box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.06);\n        border-radius: 3px;\n        padding: 0;\n        margin: 0;\n        list-style: none;\n\n        & > li:first-child {\n          border-top-left-radius: 3px;\n          border-top-right-radius: 3px;\n        }\n        & > li:last-child {\n          border-bottom-left-radius: 3px;\n          border-bottom-right-radius: 3px;\n        }\n      `}\n      {...props}\n    />\n  )\n}\n/* eslint-enable react/prop-types */\n\nconst AutoCompleteMemo = React.memo(AutoComplete)\n\nexport default React.forwardRef((props, ref) => (\n  <AutoCompleteMemo {...props} forwardedRef={ref} />\n))\n"],"names":["AutoComplete","forwardedRef","itemButtonStyles","items","onSelect","noop","onChange","placeholder","renderItem","identity","required","value","wide","ref","uniqueItems","Set","opened","setOpened","useState","wrapRef","useRef","refs","handleClose","useCallback","handleFocus","handleSelect","item","handleInputChange","params","handleFocusLeave","useFocusLeave","highlightedIndex","setHighlightedIndex","useArrowKeysFocus","useClickOutside","useKeyDown","KEY_ESC","useEffect","springs","swift","length","scale","opacity","show","transform","interpolate","t","Array","from","map","index","key","node","current","propTypes","PropTypes","object","string","array","isRequired","func","bool","Item","React","forwardRef","children","onHighlight","selected","theme","useTheme","handleClick","event","preventDefault","handleFocusOrMouseOver","unselectable","accent","surfaceHighlight","Items","props","surfaceContent","surface","border","AutoCompleteMemo","memo"],"mappings":"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"}