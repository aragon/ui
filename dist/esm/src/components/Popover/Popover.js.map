{"version":3,"file":"Popover.js","sources":["../../../../../src/components/Popover/Popover.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from '../../proptypes'\nimport Popper from 'popper.js'\nimport { Transition, animated } from 'react-spring'\nimport { useRoot } from '../../providers'\nimport { springs, GU, RADIUS } from '../../style'\nimport { useTheme } from '../../theme'\nimport { noop, stylingProps, warn, KEY_ESC } from '../../utils'\nimport RootPortal from '../RootPortal/RootPortal'\n\nclass PopoverBase extends React.Component {\n  static propTypes = {\n    children: PropTypes.node,\n    closeOnOpenerFocus: PropTypes.bool,\n    onClose: PropTypes.func,\n    opener: PropTypes._element,\n    placement: PropTypes.oneOf(\n      // \"center\" is a value that doesn’t exist in Popper, but we are using it\n      // to define custom Popper settings (see getPopperSettings() below).\n      ['center'].concat(\n        ...['auto', 'top', 'right', 'bottom', 'left'].map(position => [\n          position,\n          `${position}-start`,\n          `${position}-end`,\n        ])\n      )\n    ),\n    rootBoundary: PropTypes._element,\n    theme: PropTypes.object,\n    transitionStyles: PropTypes.object,\n    zIndex: PropTypes.number,\n  }\n\n  static defaultProps = {\n    closeOnOpenerFocus: false,\n    opener: null,\n    placement: 'center',\n    onClose: noop,\n    zIndex: 999,\n  }\n\n  _cardElement = React.createRef()\n  _popperElement = React.createRef()\n  _document = null\n  _popper = null\n\n  componentDidMount() {\n    this._document = this._popperElement.current.ownerDocument\n    this._document.addEventListener('keydown', this.handleEscape)\n    this.focus()\n    this.initPopper()\n  }\n\n  componentWillUnmount() {\n    this.destroyPopper()\n    this._document.removeEventListener('keydown', this.handleEscape)\n    delete this._document\n    delete this._popper\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { placement, children, opener } = this.props\n    if (\n      prevProps.placement !== placement ||\n      prevProps.children !== children ||\n      prevProps.opener !== opener\n    ) {\n      this.destroyPopper()\n      this.initPopper()\n    }\n  }\n\n  focus() {\n    if (this._cardElement.current) {\n      this._cardElement.current.focus()\n    }\n  }\n\n  getPopperSettings() {\n    const { placement, rootBoundary } = this.props\n\n    const settings = {\n      placement,\n      modifiers: {\n        preventOverflow: {\n          enabled: true,\n          padding: 10,\n          boundariesElement: rootBoundary || 'window',\n        },\n      },\n      positionFixed: false,\n    }\n\n    if (placement !== 'center') {\n      return settings\n    }\n\n    return {\n      ...settings,\n      placement: 'top-start',\n      modifiers: {\n        ...settings.modifiers,\n        arrow: { enabled: false },\n        flip: { enabled: false },\n        offset: { enabled: true, offset: '50% - 50%p, -50%p - 50%' },\n      },\n    }\n  }\n\n  initPopper() {\n    const { opener } = this.props\n    if (!this._popper) {\n      this._popper = new Popper(\n        opener,\n        this._popperElement.current,\n        this.getPopperSettings()\n      )\n    }\n  }\n\n  destroyPopper() {\n    if (this._popper) {\n      this._popper.destroy()\n      this._popper = null\n    }\n  }\n\n  handleEscape = ({ keyCode }) => {\n    if (keyCode === KEY_ESC) {\n      // On escape, we always move the focus back to the opener.\n      this.props.opener.focus()\n      this.attemptClose()\n    }\n  }\n\n  handleBlur = event => {\n    const { closeOnOpenerFocus, opener } = this.props\n    const focusedElement = event.relatedTarget\n\n    // Do not close if:\n    // - The blur event is emitted from an element inside of the popover.\n    // - The focused target is the opener and closeOnOpenerFocus is true.\n    if (\n      (this._cardElement.current &&\n        this._cardElement.current.contains(focusedElement)) ||\n      (closeOnOpenerFocus && opener && opener.contains(focusedElement))\n    ) {\n      if (\n        closeOnOpenerFocus &&\n        (opener.tagName === 'BUTTON' || opener.tagName === 'INPUT')\n      ) {\n        warn(\n          'Popover: using \"closeOnOpenerFocus\" with a <button> or <input> may lead to bugs due ' +\n            'to cross-environment focus event handling. ' +\n            'See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus ' +\n            'for more information.'\n        )\n      }\n      return\n    }\n\n    // Probably a click outside, that doesn’t focus anything else: move the\n    // focus back to the opener.\n    if (!focusedElement) {\n      opener.focus()\n    }\n    this.attemptClose()\n  }\n\n  attemptClose() {\n    const accepted = this.props.onClose()\n\n    // If closing the popover is not accepted, we need to focus it again so\n    // that it can react to onBlur events.\n    if (accepted === false) {\n      this.focus()\n    }\n  }\n\n  boundaryDimensions() {\n    const { rootBoundary } = this.props\n    const hasWindow = typeof window !== 'undefined'\n    return rootBoundary\n      ? [rootBoundary.clientWidth, rootBoundary.clientHeight]\n      : [hasWindow ? window.innerWidth : 0, hasWindow ? window.innerHeight : 0]\n  }\n\n  render() {\n    const { children, theme, transitionStyles, zIndex } = this.props\n    const { scale, opacity } = transitionStyles\n    const [maxWidth, maxHeight] = this.boundaryDimensions()\n    return (\n      <animated.div\n        css={`\n          // default styles until Popper takes over\n          position: absolute;\n          top: 0;\n          left: 0;\n        `}\n        ref={this._popperElement}\n        style={{ zIndex }}\n      >\n        <animated.div\n          tabIndex=\"0\"\n          onBlur={this.handleBlur}\n          ref={this._cardElement}\n          style={{\n            opacity,\n            transform: scale.interpolate(v => `scale3d(${v}, ${v}, 1)`),\n            maxHeight: `${maxHeight - 2 * GU}px`,\n            maxWidth: `${maxWidth - 2 * GU}px`,\n          }}\n          css={`\n            background: ${theme.surface};\n            border: 1px solid ${theme.border};\n            border-radius: ${RADIUS}px;\n            filter: drop-shadow(0 4px 4px rgba(0, 0, 0, 0.15));\n            &:focus {\n              /* Having the popover visible already means that it focused. */\n              outline: 0;\n            }\n            overflow-y: auto;\n          `}\n          {...stylingProps(this)}\n        >\n          {children}\n        </animated.div>\n      </animated.div>\n    )\n  }\n}\n\nfunction Popover({ scaleEffect, visible, ...props }) {\n  const theme = useTheme()\n  const root = useRoot()\n\n  return (\n    <RootPortal>\n      <Transition\n        items={visible}\n        config={springs.swift}\n        from={{ scale: scaleEffect ? 0.9 : 1, opacity: 0 }}\n        enter={{ scale: 1, opacity: 1 }}\n        leave={{ scale: scaleEffect ? 0.9 : 1, opacity: 0 }}\n        native\n      >\n        {visible =>\n          visible &&\n          (transitionStyles => (\n            <PopoverBase\n              {...props}\n              rootBoundary={root}\n              theme={theme}\n              transitionStyles={transitionStyles}\n            />\n          ))\n        }\n      </Transition>\n    </RootPortal>\n  )\n}\n\nPopover.propTypes = {\n  ...PopoverBase.propTypes,\n  scaleEffect: PropTypes.bool,\n  visible: PropTypes.bool,\n}\n\nPopover.defaultProps = {\n  ...PopoverBase.defaultProps,\n  scaleEffect: true,\n  visible: true,\n}\n\nexport default Popover\n"],"names":["PopoverBase","React","Component","createRef","keyCode","KEY_ESC","props","opener","focus","attemptClose","event","closeOnOpenerFocus","focusedElement","relatedTarget","_cardElement","current","contains","tagName","warn","componentDidMount","_document","_popperElement","ownerDocument","addEventListener","handleEscape","initPopper","componentWillUnmount","destroyPopper","removeEventListener","_popper","componentDidUpdate","prevProps","prevState","placement","children","getPopperSettings","rootBoundary","settings","modifiers","preventOverflow","enabled","padding","boundariesElement","positionFixed","arrow","flip","offset","Popper","destroy","accepted","onClose","boundaryDimensions","hasWindow","window","clientWidth","clientHeight","innerWidth","innerHeight","render","theme","transitionStyles","zIndex","scale","opacity","maxWidth","maxHeight","handleBlur","transform","interpolate","v","GU","stylingProps","surface","border","PropTypes","node","bool","func","_element","oneOf","concat","map","position","object","number","noop","Popover","scaleEffect","visible","useTheme","root","useRoot","springs","swift","propTypes","defaultProps","RADIUS"],"mappings":"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"}