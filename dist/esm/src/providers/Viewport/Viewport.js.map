{"version":3,"file":"Viewport.js","sources":["../../../../../src/providers/Viewport/Viewport.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport { BREAKPOINTS } from '../../style'\nimport throttle from 'lodash/throttle'\n\nconst NO_DOM_WINDOW_SIZE = { width: 0, height: 0 }\n\nconst WINDOW_SIZE_BASE = { breakpoints: BREAKPOINTS, ...getCurrentWindowSize() }\n\nconst ViewportContext = React.createContext(WINDOW_SIZE_BASE)\n\nfunction getCurrentWindowSize() {\n  return typeof window === 'undefined'\n    ? NO_DOM_WINDOW_SIZE\n    : { width: window.innerWidth, height: window.innerHeight }\n}\n\nclass ViewportProvider extends React.Component {\n  static propTypes = {\n    children: PropTypes.node,\n    throttle: PropTypes.number,\n  }\n\n  static defaultProps = {\n    throttle: 100,\n  }\n\n  state = { windowSize: this.getWindowSize() }\n\n  componentDidMount() {\n    this.resizeStart()\n  }\n\n  componentWillUnmount() {\n    this.resizeStop()\n  }\n\n  componentDidUpdate(prevProps) {\n    const { throttle } = this.props\n    if (prevProps.throttle !== throttle) {\n      this.resizeStop()\n      this.resizeStart()\n    }\n  }\n\n  resizeStart() {\n    this._handleResize = throttle(this.updateWindowSize, this.props.throttle)\n    this.updateWindowSize()\n\n    if (typeof window !== 'undefined') {\n      window.addEventListener('resize', this._handleResize)\n    }\n  }\n\n  resizeStop() {\n    if (!this._handleResize) {\n      return\n    }\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('resize', this._handleResize)\n    }\n    this._handleResize.cancel()\n    delete this._handleResize\n  }\n\n  updateWindowSize = () => {\n    this.setState({ windowSize: this.getWindowSize() })\n  }\n\n  getWindowSize() {\n    return {\n      ...WINDOW_SIZE_BASE,\n      ...getCurrentWindowSize(),\n    }\n  }\n\n  // Check if the current width is between two points.\n  // Accepts a breakpoint string ('small', 'large') or numbers (width in pixels).\n  // `min` is inclusive and `max` is exclusive.\n  within = (min, max) => {\n    const { width } = this.state.windowSize\n\n    // Accept \"\" or -1 indifferently\n    if (min === '') min = -1\n    if (max === '') max = -1\n\n    // Convert breakpoints into numbers\n    if (typeof min === 'string') min = BREAKPOINTS[min]\n    if (typeof max === 'string') max = BREAKPOINTS[max]\n\n    if (typeof min !== 'number') {\n      throw new Error(`Viewport: invalid minimum value (${min}).`)\n    }\n    if (typeof max !== 'number') {\n      throw new Error(`Viewport: invalid maximum value (${max}).`)\n    }\n\n    return (min === -1 || width >= min) && (max === -1 || width < max)\n  }\n\n  above = value => this.within(value, -1)\n  below = value => this.within(-1, value)\n\n  render() {\n    const { windowSize } = this.state\n    const { children } = this.props\n    const { within, above, below } = this\n    return (\n      <ViewportContext.Provider value={{ ...windowSize, within, above, below }}>\n        {children}\n      </ViewportContext.Provider>\n    )\n  }\n}\n\n// React emits a warning message if `Provider` is attached to `Consumer`, this\n// is only to prevent it.\nconst Viewport = props => <ViewportContext.Consumer {...props} />\n\nViewport.Provider = ViewportProvider\n\nexport const useViewport = () => React.useContext(ViewportContext)\nexport { Viewport }\nexport default Viewport\n"],"names":["NO_DOM_WINDOW_SIZE","width","height","WINDOW_SIZE_BASE","breakpoints","BREAKPOINTS","getCurrentWindowSize","ViewportContext","React","createContext","window","innerWidth","innerHeight","ViewportProvider","Component","windowSize","getWindowSize","setState","min","max","state","Error","value","within","componentDidMount","resizeStart","componentWillUnmount","resizeStop","componentDidUpdate","prevProps","throttle","props","_handleResize","updateWindowSize","addEventListener","removeEventListener","cancel","render","children","above","below","PropTypes","node","number","Viewport","Provider","useViewport","useContext"],"mappings":";;;;;;AAKA,MAAMA,kBAAkB,GAAG;AAAEC,EAAAA,KAAK,EAAE,CAAT;AAAYC,EAAAA,MAAM,EAAE;AAApB,CAA3B;AAEA,MAAMC,gBAAgB,GAAG;AAAEC,EAAAA,WAAW,EAAEC,WAAf;AAA4B,KAAGC,oBAAoB;AAAnD,CAAzB;AAEA,MAAMC,eAAe,gBAAGC,KAAK,CAACC,aAAN,CAAoBN,gBAApB,CAAxB;;AAEA,SAASG,oBAAT,GAAgC;AAC9B,SAAO,OAAOI,MAAP,KAAkB,WAAlB,GACHV,kBADG,GAEH;AAAEC,IAAAA,KAAK,EAAES,MAAM,CAACC,UAAhB;AAA4BT,IAAAA,MAAM,EAAEQ,MAAM,CAACE;AAA3C,GAFJ;AAGD;;AAED,MAAMC,gBAAN,SAA+BL,KAAK,CAACM,SAArC,CAA+C;AAAA;AAAA;;AAAA,mCAUrC;AAAEC,MAAAA,UAAU,EAAE,KAAKC,aAAL;AAAd,KAVqC;;AAAA,8CAgD1B,MAAM;AACvB,WAAKC,QAAL,CAAc;AAAEF,QAAAA,UAAU,EAAE,KAAKC,aAAL;AAAd,OAAd;AACD,KAlD4C;;AAAA,oCA8DpC,CAACE,GAAD,EAAMC,GAAN,KAAc;AACrB,YAAM;AAAElB,QAAAA;AAAF,UAAY,KAAKmB,KAAL,CAAWL,UAA7B,CADqB;;AAIrB,UAAIG,GAAG,KAAK,EAAZ,EAAgBA,GAAG,GAAG,CAAC,CAAP;AAChB,UAAIC,GAAG,KAAK,EAAZ,EAAgBA,GAAG,GAAG,CAAC,CAAP,CALK;;AAQrB,UAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6BA,GAAG,GAAGb,WAAW,CAACa,GAAD,CAAjB;AAC7B,UAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6BA,GAAG,GAAGd,WAAW,CAACc,GAAD,CAAjB;;AAE7B,UAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6B;AAC3B,cAAM,IAAIG,KAAJ,CAAW,oCAAmCH,GAAI,IAAlD,CAAN;AACD;;AACD,UAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6B;AAC3B,cAAM,IAAIE,KAAJ,CAAW,oCAAmCF,GAAI,IAAlD,CAAN;AACD;;AAED,aAAO,CAACD,GAAG,KAAK,CAAC,CAAT,IAAcjB,KAAK,IAAIiB,GAAxB,MAAiCC,GAAG,KAAK,CAAC,CAAT,IAAclB,KAAK,GAAGkB,GAAvD,CAAP;AACD,KAjF4C;;AAAA,mCAmFrCG,KAAK,IAAI,KAAKC,MAAL,CAAYD,KAAZ,EAAmB,CAAC,CAApB,CAnF4B;;AAAA,mCAoFrCA,KAAK,IAAI,KAAKC,MAAL,CAAY,CAAC,CAAb,EAAgBD,KAAhB,CApF4B;AAAA;;AAY7CE,EAAAA,iBAAiB,GAAG;AAClB,SAAKC,WAAL;AACD;;AAEDC,EAAAA,oBAAoB,GAAG;AACrB,SAAKC,UAAL;AACD;;AAEDC,EAAAA,kBAAkB,CAACC,SAAD,EAAY;AAC5B,UAAM;AAAEC,MAAAA;AAAF,QAAe,KAAKC,KAA1B;;AACA,QAAIF,SAAS,CAACC,QAAV,KAAuBA,QAA3B,EAAqC;AACnC,WAAKH,UAAL;AACA,WAAKF,WAAL;AACD;AACF;;AAEDA,EAAAA,WAAW,GAAG;AACZ,SAAKO,aAAL,GAAqBF,QAAQ,CAAC,KAAKG,gBAAN,EAAwB,KAAKF,KAAL,CAAWD,QAAnC,CAA7B;AACA,SAAKG,gBAAL;;AAEA,QAAI,OAAOvB,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,MAAAA,MAAM,CAACwB,gBAAP,CAAwB,QAAxB,EAAkC,KAAKF,aAAvC;AACD;AACF;;AAEDL,EAAAA,UAAU,GAAG;AACX,QAAI,CAAC,KAAKK,aAAV,EAAyB;AACvB;AACD;;AACD,QAAI,OAAOtB,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,MAAAA,MAAM,CAACyB,mBAAP,CAA2B,QAA3B,EAAqC,KAAKH,aAA1C;AACD;;AACD,SAAKA,aAAL,CAAmBI,MAAnB;;AACA,WAAO,KAAKJ,aAAZ;AACD;;AAMDhB,EAAAA,aAAa,GAAG;AACd,WAAO,EACL,GAAGb,gBADE;AAEL,SAAGG,oBAAoB;AAFlB,KAAP;AAID,GAzD4C;AA4D7C;AACA;;;AAyBA+B,EAAAA,MAAM,GAAG;AACP,UAAM;AAAEtB,MAAAA;AAAF,QAAiB,KAAKK,KAA5B;AACA,UAAM;AAAEkB,MAAAA;AAAF,QAAe,KAAKP,KAA1B;AACA,UAAM;AAAER,MAAAA,MAAF;AAAUgB,MAAAA,KAAV;AAAiBC,MAAAA;AAAjB,QAA2B,IAAjC;AACA,wBACE,oBAAC,eAAD,CAAiB,QAAjB;AAA0B,MAAA,KAAK,EAAE,EAAE,GAAGzB,UAAL;AAAiBQ,QAAAA,MAAjB;AAAyBgB,QAAAA,KAAzB;AAAgCC,QAAAA;AAAhC;AAAjC,OACGF,QADH,CADF;AAKD;;AA/F4C;AAmG/C;;;gBAnGMzB,+BACe;AACjByB,EAAAA,QAAQ,EAAEG,SAAS,CAACC,IADH;AAEjBZ,EAAAA,QAAQ,EAAEW,SAAS,CAACE;AAFH;;gBADf9B,kCAMkB;AACpBiB,EAAAA,QAAQ,EAAE;AADU;;MA8FlBc,QAAQ,GAAGb,KAAK,iBAAI,oBAAC,eAAD,CAAiB,QAAjB,EAA8BA,KAA9B;;AAE1Ba,QAAQ,CAACC,QAAT,GAAoBhC,gBAApB;MAEaiC,WAAW,GAAG,MAAMtC,KAAK,CAACuC,UAAN,CAAiBxC,eAAjB;;;;"}