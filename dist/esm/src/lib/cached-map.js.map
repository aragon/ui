{"version":3,"file":"cached-map.js","sources":["../../../../src/lib/cached-map.js"],"sourcesContent":["const A_DAY = 1000 * 60 * 60 * 24\n\nfunction cachedMap({ expireAfter = A_DAY, size = 100 } = {}) {\n  const cache = new Map()\n\n  // Delete the first (oldest) entry if we are above `size`. `cache.size`\n  // should never be greater than `size + 1`, so no need for a loop here.\n  function trim() {\n    if (cache.size > size) {\n      cache.delete(cache.keys().next().value)\n    }\n  }\n\n  // We are using delete() then set() to reset the position everytime the\n  // access is refreshed. That way, the oldest entry is always at the first\n  // position and we donâ€™t need to iterate over the entire cache to find it.\n  function update(key, value, lastAccess) {\n    cache.delete(key)\n    cache.set(key, { value, lastAccess })\n    trim()\n  }\n\n  function get(key) {\n    const now = new Date()\n\n    const cachedEntry = cache.get(key)\n\n    if (!cachedEntry) {\n      return null\n    }\n\n    // Expired: delete the entry\n    if (now - cachedEntry.lastAccess > expireAfter) {\n      cache.delete(key)\n      return null\n    }\n\n    update(key, cachedEntry.value, now)\n\n    return cachedEntry.value\n  }\n\n  function set(key, value) {\n    update(key, value, new Date())\n  }\n\n  return {\n    clear: () => cache.clear(),\n    delete: key => cache.delete(key),\n    get,\n    set,\n  }\n}\n\nexport default cachedMap\n"],"names":["A_DAY","cachedMap","expireAfter","size","cache","Map","trim","delete","keys","next","value","update","key","lastAccess","set","get","now","Date","cachedEntry","clear"],"mappings":"AAAA,MAAMA,KAAK,GAAG,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAA/B;;AAEA,SAASC,SAAT,CAAmB;AAAEC,EAAAA,WAAW,GAAGF,KAAhB;AAAuBG,EAAAA,IAAI,GAAG;AAA9B,IAAsC,EAAzD,EAA6D;AAC3D,QAAMC,KAAK,GAAG,IAAIC,GAAJ,EAAd,CAD2D;AAI3D;;AACA,WAASC,IAAT,GAAgB;AACd,QAAIF,KAAK,CAACD,IAAN,GAAaA,IAAjB,EAAuB;AACrBC,MAAAA,KAAK,CAACG,MAAN,CAAaH,KAAK,CAACI,IAAN,GAAaC,IAAb,GAAoBC,KAAjC;AACD;AACF,GAT0D;AAY3D;AACA;;;AACA,WAASC,MAAT,CAAgBC,GAAhB,EAAqBF,KAArB,EAA4BG,UAA5B,EAAwC;AACtCT,IAAAA,KAAK,CAACG,MAAN,CAAaK,GAAb;AACAR,IAAAA,KAAK,CAACU,GAAN,CAAUF,GAAV,EAAe;AAAEF,MAAAA,KAAF;AAASG,MAAAA;AAAT,KAAf;AACAP,IAAAA,IAAI;AACL;;AAED,WAASS,GAAT,CAAaH,GAAb,EAAkB;AAChB,UAAMI,GAAG,GAAG,IAAIC,IAAJ,EAAZ;AAEA,UAAMC,WAAW,GAAGd,KAAK,CAACW,GAAN,CAAUH,GAAV,CAApB;;AAEA,QAAI,CAACM,WAAL,EAAkB;AAChB,aAAO,IAAP;AACD,KAPe;;;AAUhB,QAAIF,GAAG,GAAGE,WAAW,CAACL,UAAlB,GAA+BX,WAAnC,EAAgD;AAC9CE,MAAAA,KAAK,CAACG,MAAN,CAAaK,GAAb;AACA,aAAO,IAAP;AACD;;AAEDD,IAAAA,MAAM,CAACC,GAAD,EAAMM,WAAW,CAACR,KAAlB,EAAyBM,GAAzB,CAAN;AAEA,WAAOE,WAAW,CAACR,KAAnB;AACD;;AAED,WAASI,GAAT,CAAaF,GAAb,EAAkBF,KAAlB,EAAyB;AACvBC,IAAAA,MAAM,CAACC,GAAD,EAAMF,KAAN,EAAa,IAAIO,IAAJ,EAAb,CAAN;AACD;;AAED,SAAO;AACLE,IAAAA,KAAK,EAAE,MAAMf,KAAK,CAACe,KAAN,EADR;AAELZ,IAAAA,MAAM,EAAEK,GAAG,IAAIR,KAAK,CAACG,MAAN,CAAaK,GAAb,CAFV;AAGLG,IAAAA,GAHK;AAILD,IAAAA;AAJK,GAAP;AAMD;;;;"}