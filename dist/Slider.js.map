{"version":3,"file":"Slider.js","sources":["../src/components/Slider/Slider.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport { Spring, animated } from 'react-spring'\nimport { springs } from '../../style'\nimport { useTheme } from '../../theme'\nimport { unselectable } from '../../utils'\n\nconst BAR_HEIGHT = 6\nconst HANDLE_SIZE = 24\nconst HANDLE_SHADOW_MARGIN = 15\nconst PADDING = 5\nconst MIN_WIDTH = HANDLE_SIZE * 10\nconst HEIGHT = Math.max(HANDLE_SIZE, BAR_HEIGHT) + PADDING * 2\n\n// The check on window.DOMRect is needed for the JSDOM environment, which has\n// window but not window.DOMRect. JSDOM is used by default in Jest.\nconst DEFAULT_RECT =\n  typeof window === 'undefined' || typeof window.DOMRect !== 'function'\n    ? { x: 0, y: 0, width: 0, height: 0, top: 0, right: 0, bottom: 0, left: 0 }\n    : new window.DOMRect()\n\nclass Slider extends React.Component {\n  static propTypes = {\n    value: PropTypes.number,\n    onUpdate: PropTypes.func,\n    theme: PropTypes.object,\n  }\n  static defaultProps = {\n    value: 0,\n    onUpdate: () => {},\n  }\n  state = {\n    pressed: false,\n  }\n  componentWillUnmount() {\n    this.dragStop()\n  }\n  handleRef = element => {\n    this._mainElement = element\n    this._document = element && element.ownerDocument\n  }\n  getRect = () => {\n    const now = Date.now()\n\n    // Cache the rect if the last poll was less than a second ago\n    if (this._lastRect && now - this._lastRectTime < 1000) {\n      return this._lastRect\n    }\n\n    this._lastRectTime = now\n    this._lastRect = this._mainElement\n      ? this._mainElement.getBoundingClientRect()\n      : DEFAULT_RECT\n\n    return this._lastRect\n  }\n  clientXFromEvent(event) {\n    return (event.touches ? event.touches.item(0) : event).clientX\n  }\n  updateValueFromClientX(clientX) {\n    const rect = this.getRect()\n    const x = Math.min(rect.width, Math.max(0, clientX - rect.x))\n    this.props.onUpdate(x / rect.width)\n  }\n  dragStart = event => {\n    this.dragStop()\n    const clientX = this.clientXFromEvent(event)\n    this.setState({ pressed: true }, () => {\n      this.updateValueFromClientX(clientX)\n    })\n    this._document.addEventListener('mouseup', this.dragStop)\n    this._document.addEventListener('touchend', this.dragStop)\n    this._document.addEventListener('mousemove', this.dragMove)\n    this._document.addEventListener('touchmove', this.dragMove)\n  }\n  dragStop = () => {\n    this.setState({ pressed: false })\n    this._document.removeEventListener('mouseup', this.dragStop)\n    this._document.removeEventListener('touchend', this.dragStop)\n    this._document.removeEventListener('mousemove', this.dragMove)\n    this._document.removeEventListener('touchmove', this.dragMove)\n  }\n  dragMove = event => {\n    if (!this.state.pressed) {\n      return\n    }\n\n    this.updateValueFromClientX(this.clientXFromEvent(event))\n  }\n  getHandleStyles(pressProgress) {\n    return {\n      transform: pressProgress.interpolate(\n        t => `translate3d(0, calc(${t * 0.5}px - 50%), 0)`\n      ),\n      boxShadow: pressProgress.interpolate(\n        t => `0 1px 3px rgba(0, 0, 0, ${0.1 - 0.02 * t})`\n      ),\n      background: pressProgress.interpolate(\n        t => `hsl(0, 0%, ${100 * (1 - t * 0.01)}%)`\n      ),\n    }\n  }\n  getHandlePositionStyles(value) {\n    return {\n      transform: value.interpolate(\n        t => `translate3d(calc(${t * 100}% + ${HANDLE_SHADOW_MARGIN}px), 0, 0)`\n      ),\n    }\n  }\n  getActiveBarStyles(value, pressProgress) {\n    return {\n      transform: value.interpolate(t => `scaleX(${t}) translateZ(0)`),\n    }\n  }\n  render() {\n    const { pressed } = this.state\n    const { onUpdate, value, theme, ...props } = this.props\n    return (\n      <Spring\n        native\n        config={springs.swift}\n        to={{\n          pressProgress: Number(pressed),\n          value: Math.max(0, Math.min(1, value)),\n        }}\n      >\n        {({ value, pressProgress }) => (\n          <div\n            css={`\n              min-width: ${MIN_WIDTH}px;\n              padding: 0 ${HANDLE_SIZE / 2 + PADDING}px;\n              ${unselectable};\n            `}\n            {...props}\n          >\n            <div\n              ref={this.handleRef}\n              onMouseDown={this.dragStart}\n              onTouchStart={this.dragStart}\n              css={`\n                position: relative;\n                height: ${HEIGHT}px;\n                cursor: pointer;\n              `}\n            >\n              <Bars>\n                <Bar\n                  css={`\n                    background: ${theme.surfaceUnder};\n                  `}\n                />\n                <Bar\n                  style={this.getActiveBarStyles(value, pressProgress)}\n                  css={`\n                    transform-origin: 0 0;\n                    background: ${theme.selected};\n                  `}\n                />\n              </Bars>\n\n              <HandleClip>\n                <HandlePosition\n                  style={this.getHandlePositionStyles(value, pressProgress)}\n                >\n                  <animated.div\n                    style={this.getHandleStyles(pressProgress)}\n                    css={`\n                      position: absolute;\n                      top: 50%;\n                      left: 0;\n                      width: ${HANDLE_SIZE}px;\n                      height: ${HANDLE_SIZE}px;\n                      border: 1px solid ${theme.border};\n                      border-radius: 50%;\n                      cursor: pointer;\n                      pointer-events: auto;\n                    `}\n                  />\n                </HandlePosition>\n              </HandleClip>\n            </div>\n          </div>\n        )}\n      </Spring>\n    )\n  }\n}\n\nconst Bars = styled(animated.div)`\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 50%;\n  transform: translateY(-50%);\n  overflow: hidden;\n  border-radius: 2px;\n  height: ${BAR_HEIGHT}px;\n`\n\nconst Bar = styled(animated.div)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n`\n\nconst HandleClip = styled.div`\n  pointer-events: none;\n  overflow: hidden;\n  width: calc(100% + ${HANDLE_SIZE + HANDLE_SHADOW_MARGIN * 2}px);\n  height: calc(100% + ${HANDLE_SHADOW_MARGIN * 2}px);\n  transform-origin: 50% 50%;\n  transform: translate(\n    -${HANDLE_SIZE / 2 + HANDLE_SHADOW_MARGIN}px,\n    -${HANDLE_SHADOW_MARGIN}px\n  );\n`\n\nconst HandlePosition = styled(animated.div)`\n  width: calc(100% - ${HANDLE_SIZE + HANDLE_SHADOW_MARGIN * 2}px);\n  height: 100%;\n  transform-origin: 50% 50%;\n`\n\nexport default props => {\n  const theme = useTheme()\n  return <Slider theme={theme} {...props} />\n}\n"],"names":["BAR_HEIGHT","HANDLE_SIZE","HANDLE_SHADOW_MARGIN","PADDING","MIN_WIDTH","HEIGHT","Math","max","DEFAULT_RECT","window","DOMRect","x","y","width","height","top","right","bottom","left","Slider","React","Component","pressed","element","_mainElement","_document","ownerDocument","now","Date","_lastRect","_lastRectTime","getBoundingClientRect","event","dragStop","clientX","clientXFromEvent","setState","updateValueFromClientX","addEventListener","dragMove","removeEventListener","state","componentWillUnmount","touches","item","rect","getRect","min","props","onUpdate","getHandleStyles","pressProgress","transform","interpolate","t","boxShadow","background","getHandlePositionStyles","value","getActiveBarStyles","render","theme","Spring","springs","swift","Number","handleRef","dragStart","surfaceUnder","selected","border","PropTypes","number","func","object","Bars","styled","animated","div","Bar","HandleClip","HandlePosition","useTheme","unselectable"],"mappings":"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"}