{"version":3,"file":"AutoComplete.js","sources":["../src/components/AutoComplete/AutoComplete.js"],"sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from 'react-spring'\nimport {\n  useArrowKeysFocus,\n  useClickOutside,\n  useKeyDown,\n  useFocusLeave,\n} from '../../hooks'\nimport { springs } from '../../style'\nimport { useTheme } from '../../theme'\nimport { unselectable, noop, identity, KEY_ESC } from '../../utils'\nimport ButtonBase from '../ButtonBase/ButtonBase'\nimport SearchInput from '../Input/SearchInput'\n\nfunction AutoComplete({\n  forwardedRef,\n  itemButtonStyles = '',\n  items = [],\n  onSelect = noop,\n  onChange = noop,\n  placeholder,\n  renderItem = identity,\n  required,\n  value,\n  wide,\n}) {\n  const ref = forwardedRef\n  const uniqueItems = new Set(items)\n  const [opened, setOpened] = useState(true)\n  const wrapRef = useRef()\n  const refs = useRef([])\n\n  const handleClose = useCallback(() => setOpened(false), [])\n  const handleFocus = useCallback(() => setOpened(true), [])\n\n  const handleSelect = useCallback(\n    item => {\n      onSelect(item)\n      setOpened(false)\n    },\n    [onSelect]\n  )\n\n  const handleInputChange = useCallback(\n    (...params) => {\n      setOpened(true)\n      onChange(...params)\n    },\n    [onChange]\n  )\n\n  const { handleFocusLeave } = useFocusLeave(handleClose, wrapRef)\n  const { highlightedIndex, setHighlightedIndex } = useArrowKeysFocus(refs)\n\n  useClickOutside(handleClose, wrapRef)\n  useKeyDown(KEY_ESC, handleClose)\n\n  useEffect(() => {\n    setHighlightedIndex(-1)\n  }, [opened, items, value, setHighlightedIndex])\n\n  return (\n    <div css=\"position: relative\" ref={wrapRef} onBlur={handleFocusLeave}>\n      <SearchInput\n        ref={ref}\n        wide={wide}\n        placeholder={placeholder}\n        required={required}\n        onChange={handleInputChange}\n        onFocus={handleFocus}\n        value={value}\n      />\n      <Transition\n        config={springs.swift}\n        items={opened && items.length > 0}\n        from={{ scale: 0.98, opacity: 0 }}\n        enter={{ scale: 1, opacity: 1 }}\n        leave={{ scale: 1, opacity: 0 }}\n        native\n      >\n        {show =>\n          show &&\n          /* eslint-disable react/prop-types */\n          (({ scale, opacity }) => (\n            <Items\n              style={{\n                opacity,\n                transform: scale.interpolate(t => `scale3d(${t},${t},1)`),\n              }}\n            >\n              {Array.from(uniqueItems).map((item, index) => (\n                <Item\n                  key={item.key || item}\n                  ref={node => (refs.current[index] = node)}\n                  index={index}\n                  item={item}\n                  itemButtonStyles={itemButtonStyles}\n                  onHighlight={setHighlightedIndex}\n                  onSelect={handleSelect}\n                  selected={index === highlightedIndex}\n                >\n                  {renderItem(item, value)}\n                </Item>\n              ))}\n            </Items>\n          ))\n        /* eslint-enable react/prop-types */\n        }\n      </Transition>\n    </div>\n  )\n}\n\nAutoComplete.propTypes = {\n  forwardedRef: PropTypes.object,\n  itemButtonStyles: PropTypes.string,\n  items: PropTypes.array.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  placeholder: PropTypes.string,\n  renderItem: PropTypes.func,\n  required: PropTypes.bool,\n  value: PropTypes.string,\n  wide: PropTypes.bool,\n}\n\n/* eslint-disable react/prop-types */\nconst Item = React.forwardRef(function Item(\n  { children, index, item, itemButtonStyles, onHighlight, onSelect, selected },\n  ref\n) {\n  const theme = useTheme()\n\n  const handleClick = useCallback(\n    event => {\n      event.preventDefault()\n      onSelect(item)\n    },\n    [item, onSelect]\n  )\n\n  const handleFocusOrMouseOver = useCallback(() => {\n    onHighlight(index)\n  }, [index, onHighlight])\n\n  return (\n    <li\n      role=\"option\"\n      css={`\n        overflow: hidden;\n        cursor: pointer;\n        ${unselectable()};\n      `}\n    >\n      <ButtonBase\n        ref={ref}\n        onClick={handleClick}\n        onFocus={handleFocusOrMouseOver}\n        onMouseOver={handleFocusOrMouseOver}\n        css={`\n          text-align: left;\n          padding: 4px 8px;\n          width: 100%;\n          border-radius: 0;\n          border-left: 3px solid transparent;\n          cursor: pointer;\n\n          ${selected\n            ? `\n                outline: 2px solid ${theme.accent};\n                background: ${theme.surfaceHighlight};\n                border-left: 3px solid ${theme.accent};\n              `\n            : ''};\n          ${itemButtonStyles};\n        `}\n      >\n        {children}\n      </ButtonBase>\n    </li>\n  )\n})\n/* eslint-enable react/prop-types */\n\n/* eslint-disable react/prop-types */\nconst Items = function Items(props) {\n  const theme = useTheme()\n  return (\n    <animated.ul\n      role=\"listbox\"\n      css={`\n        position: absolute;\n        z-index: 2;\n        top: 100%;\n        width: 100%;\n        padding: 8px 0;\n        color: ${theme.surfaceContent};\n        background: ${theme.surface};\n        border: 1px solid ${theme.border};\n        box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.06);\n        border-radius: 3px;\n        padding: 0;\n        margin: 0;\n        list-style: none;\n\n        & > li:first-child {\n          border-top-left-radius: 3px;\n          border-top-right-radius: 3px;\n        }\n        & > li:last-child {\n          border-bottom-left-radius: 3px;\n          border-bottom-right-radius: 3px;\n        }\n      `}\n      {...props}\n    />\n  )\n}\n/* eslint-enable react/prop-types */\n\nconst AutoCompleteMemo = React.memo(AutoComplete)\n\nexport default React.forwardRef((props, ref) => (\n  <AutoCompleteMemo {...props} forwardedRef={ref} />\n))\n"],"names":["AutoComplete","forwardedRef","itemButtonStyles","items","onSelect","noop","onChange","placeholder","renderItem","identity","required","value","wide","ref","uniqueItems","Set","opened","setOpened","useState","wrapRef","useRef","refs","handleClose","useCallback","handleFocus","handleSelect","item","handleInputChange","params","handleFocusLeave","useFocusLeave","highlightedIndex","setHighlightedIndex","useArrowKeysFocus","useClickOutside","useKeyDown","KEY_ESC","useEffect","React","SearchInput","Transition","springs","swift","length","scale","opacity","show","transform","interpolate","t","Array","from","map","index","key","node","current","propTypes","PropTypes","object","string","array","isRequired","func","bool","Item","forwardRef","children","onHighlight","selected","theme","useTheme","handleClick","event","preventDefault","handleFocusOrMouseOver","unselectable","accent","surfaceHighlight","Items","props","surfaceContent","surface","border","AutoCompleteMemo","memo"],"mappings":"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"}