{"version":3,"file":"ToastHub.js","sources":["../src/components/ToastHub/ToastHub.js"],"sourcesContent":["import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { animated, Transition } from 'react-spring'\nimport RootPortal from '../RootPortal/RootPortal'\nimport { useViewport } from '../../providers/Viewport/Viewport'\nimport { stylingProps } from '../../utils'\nimport { useTheme } from '../../theme'\nimport { springs, textStyle, GU, RADIUS } from '../../style'\n\nlet id = 0\n\nconst move = pixel => `translate3d(0,${pixel}px,0)`\n\nexport const ToastContext = React.createContext(() => {\n  throw new Error(\n    \"For Toast to work it needs to be part of a ToastHub's tree, which has to be declared at an upper level!\"\n  )\n})\n\nclass ToastHubProvider extends React.PureComponent {\n  static propTypes = {\n    children: PropTypes.node,\n    position: PropTypes.PropTypes.oneOf(['left', 'center', 'right']),\n    shift: PropTypes.number,\n    showIndicator: PropTypes.bool,\n    threshold: PropTypes.number,\n    timeout: PropTypes.number,\n    top: PropTypes.bool,\n  }\n\n  static defaultProps = {\n    position: 'right',\n    showIndicator: false,\n    threshold: Infinity,\n    timeout: 4000,\n    top: false,\n  }\n\n  state = { items: [], leaving: [], preLeaving: [] }\n\n  cancelMap = new WeakMap()\n\n  add = msg => {\n    const threshold = this.props.threshold\n    this.setState(state => {\n      // This calls cancel on all leaving animations that stack up too much\n      if (threshold !== Infinity) {\n        state.leaving\n          .slice(threshold - 1)\n          .forEach(item => this.cancel(item, true))\n      }\n      return { items: [...state.items, { key: id++, msg }], preLeaving: [] }\n    })\n  }\n\n  remove = item => {\n    this.setState(state => ({\n      items: state.items.filter(i => i.key !== item.key),\n      leaving: state.leaving.includes(item)\n        ? state.leaving\n        : [item, ...state.leaving],\n    }))\n  }\n\n  config = (item, state) => {\n    const config = springs.lazy\n    // Return custom configs on leave (includes the life-line duration)\n    return state === 'leave'\n      ? [{ duration: this.props.timeout }, config, config]\n      : config\n  }\n\n  cancel = (item, secondPass = false) => {\n    if (this.cancelMap.has(item)) {\n      const fn = this.cancelMap.get(item)\n      fn()\n      // There are 3 passes: lifeline, opacity->0, height->0\n      if (secondPass) fn()\n    }\n  }\n\n  leave = item => async (next, cancel) => {\n    // Save cancel so that it can be used interactively\n    this.cancelMap.set(item, cancel)\n\n    // Lifeline first\n    await next({ to: { life: '0%' } })\n\n    // Add to the pre-leaving list, to know when there are no more toasts\n    // displayed even though they are still finishing their leaving transition.\n    this.setState(state => ({\n      preLeaving: [...state.preLeaving, item],\n    }))\n\n    // Then fade out\n    await next({ to: { opacity: 0 } })\n\n    // Then shrink, the last \"true\" informs Keyframes that is is the last frame\n    await next({ to: { height: 0 } }, true)\n\n    this.setState(state => ({\n      leaving: state.leaving.filter(i => i.key !== item.key),\n      preLeaving: state.preLeaving.filter(i => i.key !== item.key),\n    }))\n  }\n\n  render() {\n    const { children, showIndicator, position, top, shift } = this.props\n    const { items, leaving, preLeaving } = this.state\n\n    const renderList = items.length > 0 || leaving.length > 0\n    const itemsVisible =\n      leaving.length === preLeaving.length && leaving.length > 0\n        ? false\n        : renderList\n\n    return (\n      <React.Fragment>\n        <ToastContext.Provider\n          value={{\n            itemsVisible,\n            add: this.add,\n          }}\n        >\n          {children}\n        </ToastContext.Provider>\n        {renderList && (\n          <RootPortal>\n            <ToastList\n              config={this.config}\n              items={items}\n              leave={this.leave}\n              position={position}\n              remove={this.remove}\n              showIndicator={showIndicator}\n              top={top}\n              {...stylingProps(this)}\n              shift={shift}\n            />\n          </RootPortal>\n        )}\n      </React.Fragment>\n    )\n  }\n}\n\n// ToastList is separated from ToastHubProvider so we can skip its rendering\nconst ToastList = React.memo(function ToastList({\n  config,\n  items,\n  leave,\n  position,\n  remove,\n  showIndicator,\n  top,\n  shift,\n  ...props\n}) {\n  const theme = useTheme()\n  const { below } = useViewport()\n  const spacing = below('medium') ? 2 * GU : 3 * GU\n  return (\n    <div\n      css={`\n        position: fixed;\n        z-index: 1000;\n        top: ${top ? `${spacing}px` : 'unset'};\n        bottom: ${top ? 'unset' : `${spacing}px`};\n        left: ${spacing + (shift || 0)}px;\n        right: ${spacing + (shift || 0)}px;\n        display: flex;\n        margin: 0 auto;\n        flex-direction: ${top ? 'column-reverse' : 'column'};\n        pointer-events: none;\n        align-items: ${(() => {\n          if (below('medium')) return 'center'\n          if (position === 'left') return 'flex-start'\n          if (position === 'right') return 'flex-end'\n          return 'center'\n        })()};\n      `}\n      {...props}\n    >\n      <Transition\n        native\n        items={items}\n        keys={item => item.key}\n        from={{ opacity: 0, height: 0, life: '100%', transform: move(30) }}\n        enter={{ opacity: 1, height: 'auto', transform: move(0) }}\n        leave={leave}\n        onRest={remove}\n        config={config}\n      >\n        {item =>\n          /* eslint-disable react/prop-types */\n          ({ life, ...props }) => (\n            <animated.div\n              style={props}\n              css={`\n                box-sizing: border-box;\n                position: relative;\n                width: ${below('medium') ? '100%' : '42ch'};\n              `}\n            >\n              <div\n                css={`\n                  display: flex;\n                  align-items: center;\n                  overflow: hidden;\n                  height: ${6 * GU}px;\n                  margin-top: ${top ? '0' : `${1.25 * GU}px`};\n                  margin-bottom: ${top ? `${1.25 * GU}px` : '0'};\n                  padding: 0 ${2.5 * GU}px;\n                  ${textStyle('body3')};\n                  color: ${theme.floatingContent};\n                  background: ${theme.floating.alpha(0.95)};\n                  border-radius: ${RADIUS}px;\n                `}\n              >\n                {showIndicator && (\n                  <animated.div\n                    style={{ right: life }}\n                    css={`\n                      position: absolute;\n                      bottom: ${top ? `${1.25 * GU}px` : '0'};\n                      left: 0;\n                      width: auto;\n                      height: 5px;\n                      background-image: linear-gradient(\n                        130deg,\n                        #00b4e6,\n                        #00f0e0\n                      );\n                    `}\n                  />\n                )}\n                <p>{item.msg}</p>\n              </div>\n            </animated.div>\n          )\n        /* eslint-enable react/prop-types */\n        }\n      </Transition>\n    </div>\n  )\n})\n\nToastList.propTypes = {\n  config: PropTypes.func,\n  items: PropTypes.array,\n  leave: PropTypes.func,\n  position: PropTypes.PropTypes.oneOf(['left', 'center', 'right']),\n  remove: PropTypes.func,\n  shift: PropTypes.number,\n  showIndicator: PropTypes.bool,\n  top: PropTypes.bool,\n}\n\nconst useToast = () => useContext(ToastContext).add\nconst Toast = props => props.children(useToast())\n\nexport default ToastHubProvider\nexport { Toast, useToast }\n"],"names":["id","move","pixel","ToastContext","React","createContext","Error","ToastHubProvider","PureComponent","items","leaving","preLeaving","WeakMap","msg","threshold","props","setState","state","Infinity","slice","forEach","item","cancel","key","filter","i","includes","config","springs","lazy","duration","timeout","secondPass","cancelMap","has","fn","get","next","set","to","life","opacity","height","render","children","showIndicator","position","top","shift","renderList","length","itemsVisible","add","RootPortal","leave","remove","stylingProps","PropTypes","node","oneOf","number","bool","ToastList","memo","theme","useTheme","below","useViewport","spacing","GU","Transition","transform","textStyle","floatingContent","floating","alpha","right","propTypes","func","array","useToast","useContext","Toast","RADIUS"],"mappings":"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"}